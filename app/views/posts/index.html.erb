<div class="post-list-container py-4 px-5 shadow">
  <div class="container">
    <div class="row mt-5">
      <div class="col-md-6">
        <%= form_with(url: search_posts_path, local: true, method: :get, class: "search-form") do |form| %>
          <div class="input-group d-flex justify-content-center">
            <%= form.text_field :keyword, placeholder: "キーワードで投稿を検索", class: "form-control search-input mr-1" %>
            <button type="submit" class="btn btn-primary search-btn" id="search">
              <i class="fas fa-search"></i>
            </button>
          </div>
        <% end %>
      </div>
      
      <div class="col-md-6 mt-3 mt-md-0">
        <%= form_with(url: search_posts_path, local: true, method: :get, class: "search-form") do |form| %>
          <div class="input-group d-flex justify-content-end">
            <%= select_tag :prefecture_id, options_for_select(@address.map { |pref| [pref.name, pref.id] }, params[:prefecture_id]), include_blank: "都道府県を選択", class: "form-select mr-1" %>
            <%= select_tag :season, options_for_select(Post::SEASONS.map { |season| [t(".seasons.#{season}"), season] }, params[:season]), include_blank: "季節を選択", class: "form-select mr-1" %>
            <button type="submit" class="btn btn-primary search-icon-btn" id="search-category">
              <i class="fas fa-search"></i>
            </button>
          </div>
        <% end %>
      </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-5">
      <% @posts.each do |post| %>
        <div class="col mb-4">
          <div class="card">
            <%= image_tag post.image.url, class: "card-img-top", alt: "投稿の画像" %>
            <div class="card-body">
              <h5 class="card-title post-title-link">
                <%= link_to post.title.truncate(45), post_path(post), class: 'post-link text-dark' %>
              </h5>
            </div>
            <div class="card-footer d-flex justify-content-between">
              <div id="favorite-info-<%= post.id %>">
                <% if current_user && post.favorited?(current_user) %>
                  <%= link_to post_favorites_path(post.id), method: :delete, remote: true do %>
                    <i class="fa fa-heart fa-lg" style="color:#e83e8c;"></i> <span style="color:black;"><%= post.favorites.count %></span>
                  <% end %>
                <% else %>
                  <%= link_to post_favorites_path(post.id), method: :post, remote: true do %>
                    <i class="fa fa-heart fa-lg" style="color:gray;"></i> <span style="color:black;"><%= post.favorites.count %></span>
                  <% end %>
                <% end %>
              </div>

              <div class="d-flex align-items-center">
                <% if post.user.avatar? %>
                  <%= image_tag post.user.avatar.url, size: "25x25", style: "border-radius: 50%;", class: "mr-1" %>
                <% else %>
                  <%= image_tag("noavatar.png", size: "25x25", style: "border-radius: 50%;", class: "mr-1") %>
                <% end %>
                <%= link_to post.user.name, user_path(post.user_id), class: 'post-link text-muted' %>
              </div>
            </div>
          </div>
        </div>
      <% end %> 
    </div>

    <div class="d-flex justify-content-center mt-4">
      <%= paginate @posts %>
    </div>
  </div>
</div>