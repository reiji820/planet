<div class="post-list-container py-4 px-5 shadow">
  <div class="container">
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <%= form_with(url: search_posts_path, local: true, method: :get, class: "search-form custom-search-form") do |form| %>
            <div class="card shadow">
              <div class="card-body">
                <h4 class="card-title text-center mb-1">投稿を検索</h4>
                <p class="text-center search-description mt-0">
                  キーワード、都道府県、季節、ジャンル、または特定の時刻を指定して、あなたの興味に合った投稿を見つけることができます。
                </p>
                <div class="form-row">
                  <div class="form-group col-md-2">
                    <%= form.label :keyword, "キーワード", class: "form-label" %>
                    <%= form.text_field :keyword, placeholder: "キーワード", class: "form-control" %>
                  </div>
                  <div class="form-group col-md-2">
                    <%= form.label :prefecture_id, "都道府県", class: "form-label" %>
                    <%= form.select :prefecture_id, options_for_select(@address.map { |pref| [pref.name, pref.id] }, selected: params[:prefecture_id]), {include_blank: "選択"}, class: "form-control" %>
                  </div>
                  <div class="form-group col-md-2">
                    <%= form.label :season, "季節", class: "form-label" %>
                    <%= form.select :season, options_for_select(Post::SEASONS.map { |season| [t("seasons.#{season}"), season] }, selected: params[:season]), {include_blank: "選択"}, class: "form-control" %>
                  </div>
                  <div class="form-group col-md-2">
                    <%= form.label :genre, "ジャンル", class: "form-label" %>
                    <%= form.select :genre, options_for_select(TimeSchedule::GENRES, selected: params[:genre]), { include_blank: "選択" }, class: "form-control" %>
                  </div>
                  <div class="form-group col-md-2">
                    <%= form.label :time_stamp, "時刻以降", class: "form-label" %>
                    <%= form.time_field :time_stamp, class: 'form-control' %>
                  </div>
                  <div class="form-group col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                      <i class="fas fa-search"></i> 検索
                    </button>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-5">
      <% @posts.each do |post| %>
        <div class="col mb-4">
          <div class="card">
            <%= image_tag post.image.url, class: "card-img-top", alt: "投稿の画像" %>
            <div class="card-body">
              <h5 class="card-title post-title-link">
                <%= link_to post.title.truncate(45), post_path(post), class: 'post-link text-dark' %>
              </h5>
            </div>
            <div class="card-footer d-flex justify-content-between">
              <div id="favorite-info-<%= post.id %>">
                <% if current_user && post.favorited?(current_user) %>
                  <%= link_to post_favorites_path(post.id), method: :delete, remote: true do %>
                    <i class="fa fa-heart fa-lg" style="color:#e83e8c;"></i> <span style="color:black;"><%= post.favorites.count %></span>
                  <% end %>
                <% else %>
                  <%= link_to post_favorites_path(post.id), method: :post, remote: true do %>
                    <i class="fa fa-heart fa-lg" style="color:gray;"></i> <span style="color:black;"><%= post.favorites.count %></span>
                  <% end %>
                <% end %>
              </div>

              <div class="d-flex align-items-center">
                <% if post.user.avatar? %>
                  <%= image_tag post.user.avatar.url, size: "25x25", style: "border-radius: 50%;", class: "mr-1" %>
                <% else %>
                  <%= image_tag("noavatar.png", size: "25x25", style: "border-radius: 50%;", class: "mr-1") %>
                <% end %>
                <%= link_to post.user.name, user_path(post.user_id), class: 'post-link text-muted' %>
              </div>
            </div>
          </div>
        </div>
      <% end %> 
    </div>

    <div class="d-flex justify-content-center mt-4">
      <%= paginate @posts %>
    </div>
  </div>
</div>